# YaShlang [Йа-Шланг]
Online PeerTube and YouTube player for Android with local playlists and whitelisted recommendations  
for English go to [README.en.md](README.en.md)

Онлайн плеер PeerTube и YouTube с локальными плейлистами, каналами и рекомендациями.

<a href="https://f-droid.org/packages/su.sadrobot.yashlang/"><img src="https://f-droid.org/wiki/images/0/06/F-Droid-button_get-it-on.png"></a>

- Добавляйте любимые каналы и плейлисты
- Внутри добавленных плейлистов выключайте лишние ролики, если они вам не нужны
- Смотрите только то, что вам интересно

Ваш собственный безопасный онлайн-кинотеатр под вашим полным контролем.

### На главном экране и на экране плеера: случайные рекомендации из неслучайных каналов

[<img src="doc/screens/v0.1.x/glagna-1.png" width=600>](doc/screens/v0.1.x/glagna-1.png)

[<img src="doc/screens/v0.1.x/glagna-2.png" width=600>](doc/screens/v0.1.x/glagna-2.png)

[<img src="doc/screens/v0.1.x/glagna-4.png" width=600>](doc/screens/v0.1.x/glagna-4.png)

[<img src="doc/screens/v0.1.x/search-nu-pogodi-2.png" width=600>](doc/screens/v0.1.x/search-nu-pogodi-2.png)

[<img src="doc/screens/v0.1.x/player-7.png" width=600>](doc/screens/v0.1.x/player-7.png)

[<img src="doc/screens/v0.1.x/player-8.png" width=600>](doc/screens/v0.1.x/player-8.png)


### Мгновенный поиск по локальной базе

[<img src="doc/screens/v0.1.x/search-nu-pogodi-1.png" width=200>](doc/screens/v0.1.x/search-nu-pogodi-1.png) =>
[<img src="doc/screens/v0.1.x/search-nu-pogodi-3.png" width=600>](doc/screens/v0.1.x/search-nu-pogodi-3.png)


### Добавить новый канал или плейлист

[<img src="doc/screens/v0.1.x/add-playlist-1.png" width=200>](doc/screens/v0.1.x/add-playlist-1.png)
[<img src="doc/screens/v0.1.x/add-playlist-2.png" width=200>](doc/screens/v0.1.x/add-playlist-2.png)
[<img src="doc/screens/v0.1.x/add-playlist-3.png" width=200>](doc/screens/v0.1.x/add-playlist-3.png)
[<img src="doc/screens/v0.1.x/add-playlist-4.png" width=200>](doc/screens/v0.1.x/add-playlist-4.png)

[<img src="doc/screens/v0.1.x/add-playlist-6.png" width=200>](doc/screens/v0.1.x/add-playlist-6.png)
[<img src="doc/screens/v0.1.x/add-playlist-7.png" width=200>](doc/screens/v0.1.x/add-playlist-7.png)
[<img src="doc/screens/v0.1.x/add-playlist-8.png" width=200>](doc/screens/v0.1.x/add-playlist-8.png)
[<img src="doc/screens/v0.1.x/add-playlist-9.png" width=200>](doc/screens/v0.1.x/add-playlist-9.png)

Искать по имени онлайн или вставить известный адрес.

Можно вставлять адреса каналов, страниц пользователей и плейлистов PeerTube и YouTube. Поиск по имени работает только для каналов и плейлистов YouTube.

### Динамический плейлист — играть результаты поиска

[<img src="doc/screens/v0.1.x/search-and-play-all-1.png" width=200>](doc/screens/v0.1.x/search-and-play-all-1.png)
[<img src="doc/screens/v0.1.x/search-and-play-all-2.png" width=200>](doc/screens/v0.1.x/search-and-play-all-2.png) =>
[<img src="doc/screens/v0.1.x/search-and-play-all-3.png" width=200>](doc/screens/v0.1.x/search-and-play-all-3.png)

[<img src="doc/screens/v0.1.x/search-and-play-all-4.png" width=600>](doc/screens/v0.1.x/search-and-play-all-4.png)

[<img src="doc/screens/v0.1.x/search-and-play-all-5.png" width=600>](doc/screens/v0.1.x/search-and-play-all-5.png)

В рекомендациях под видео будут только ролики, удовлетворяющие поисковому запросу.

Аналогичным образом, если открыть видео из настроек плейлиста, в списке рекомендаций будут только ролики из этого же плейлиста.

### Плейлисты и каналы можно временно выключать и снова включать

[<img src="doc/screens/v0.1.x/playlist-on-off-1.png" width=200>](doc/screens/v0.1.x/playlist-on-off-1.png)
[<img src="doc/screens/v0.1.x/playlist-on-off-2.png" width=200>](doc/screens/v0.1.x/playlist-on-off-2.png)
[<img src="doc/screens/v0.1.x/playlist-on-off-3.png" width=200>](doc/screens/v0.1.x/playlist-on-off-3.png)
[<img src="doc/screens/v0.1.x/playlist-on-off-4.png" width=200>](doc/screens/v0.1.x/playlist-on-off-4.png)

_Обратите внимание: ролики из выключенного плейлиста исчезнут также из результатов поиска, истории просмотров и из списка любимых. Но не стоит переживать, они опять появятся там сразу после того, как плейлист будет снова включен._


### Внести ролик в черный список

[<img src="doc/screens/v0.1.x/blacklist-2.png" width=200>](doc/screens/v0.1.x/blacklist-2.png)
[<img src="doc/screens/v0.1.x/blacklist-3.png" width=200>](doc/screens/v0.1.x/blacklist-3.png)
[<img src="doc/screens/v0.1.x/blacklist-4.png" width=200>](doc/screens/v0.1.x/blacklist-4.png)

Заблокированный ролик не будет отображаться в рекомендациях, в результатах поиска, исчезнет из списка любимых и из истории просмотров. Ролик всё еще будет виден в настройках плейлиста.

Просмотреть черный список и снова включить элементы, заблокированные по ошибке:  
_Настройки > меню в заголовке > Черный список_

[<img src="doc/screens/v0.1.x/blacklist-5.png" width=200>](doc/screens/v0.1.x/blacklist-5.png)
[<img src="doc/screens/v0.1.x/blacklist-6.png" width=200>](doc/screens/v0.1.x/blacklist-6.png)


### Любимые ролики и история просмотров

[<img src="doc/screens/v0.1.x/player-2.png" width=200>](doc/screens/v0.1.x/player-2.png)
[<img src="doc/screens/v0.1.x/starred-1.png" width=200>](doc/screens/v0.1.x/starred-1.png)
[<img src="doc/screens/v0.1.x/history-1.png" width=200>](doc/screens/v0.1.x/history-1.png)

Любимые ролики на экране плеера отмечаются звёздочкой в правом верхнем углу.

### Контекстные меню в заголовке экрана и по долгому клику в галереях и списках

[<img src="doc/screens/v0.1.x/context-menu-1.png" width=200>](doc/screens/v0.1.x/context-menu-1.png)
[<img src="doc/screens/v0.1.x/context-menu-2.png" width=200>](doc/screens/v0.1.x/context-menu-2.png)
[<img src="doc/screens/v0.1.x/context-menu-3.png" width=200>](doc/screens/v0.1.x/context-menu-3.png)
[<img src="doc/screens/v0.1.x/context-menu-5.png" width=200>](doc/screens/v0.1.x/context-menu-5.png)

## Быстрый старт — добавить рекомендованные каналы и плейлисты

[<img src="doc/screens/v0.1.x/glagna-empty.png" width=200>](doc/screens/v0.1.x/glagna-empty.png)
[<img src="doc/screens/v0.1.x/add-recommended-1.png" width=200>](doc/screens/v0.1.x/add-recommended-1.png) =>
[<img src="doc/screens/v0.1.x/blacklist-1.png" width=200>](doc/screens/v0.1.x/blacklist-1.png)

Приложение сразу станет выглядеть так, как на скриншотах выше.

Ненужные каналы и плейлисты можно выключить или удалить в настройках.

### Кроме того

- Навигация по включенным плейлистам из главного экрана
- Профили плейлистов: можно объединить плейлисты в группы и переключить группы в зависимости от контекта (например: Мультики, Фильмы, Познавательное, История, Аналитика и т.п.)
- Всякие мелочи, про которые не успеваю сюда писать

## Установка

- В каталоге F-Droid: https://f-droid.org/packages/su.sadrobot.yashlang/
- Собирайте из исходников: https://github.com/sadr0b0t/yashlang/
- Качайте apk из раздела с релизами: https://github.com/sadr0b0t/yashlang/releases
- В каталоге AppGallery Huawei (apk из релизов github): https://appstore.huawei.com/app/C101887905
- На Гуглплее нет и ближайшее время не будет (Гугл банит приложения, которые в обход API парсят их сайт, в т.ч. упомянутый Channel Whitelist или плеер NewPipe)

Имейте ввиду, что переключаться между разными версиями из разных источников на одном устройстве не получится из-за разных подписей файла apk, перед установкой версии из нового источника придется установленную версию сначала удалить вместе с данными - кэшем плейлистов и историей просмотров (или придумать, как эти данные перенести).

## Технические детали

Не требует аккаунт Гугл/Ютюб, нужен только интернет, использует библиотеки:

- [NewPipeExtractor](https://github.com/TeamNewPipe/NewPipeExtractor/) для получения данных с сервисов PeerTube и YouTube и
- [ExoPlayer](https://exoplayer.dev/) для проигрывания видео.


Открытый исходный код, свободная лицензия GPLv3.

_вопрос: Парсить сайты без разрешения (или с явным запретом) авторов вообще законно? [Гугл удаляет из Гугл-плея приложения](https://channelwhitelist.tilda.ws/), которые не используют их API, а парсят их сайты, т.к. они нарушают их пользовательское соглашение._
_ответ: конечно, законно, это ваше дело, какой инструмент использовать для чтения общедоступной информации. Больше того: [Суд США полностью легализовал скрапинг сайтов и запретил ему технически препятствовать](https://habr.com/ru/company/globalsign/blog/466911/), но у Гугла может быть другое мнение, лично у меня пока нет желания отправляться в американский суд их переубеждать._

## Известные проблемы

- Гугл регулярно ломает совместимость для сторонних приложений, не использующих их API. Ролики Ютюб могут перестать загружаться в любой момент (еще вчера они играли, а сегодня каждый ролик выдает ошибку при загрузке). Обычно эти проблемы довольно быстро исправляются в проекте NewPipeExtractor (и в проекте youtube-dl), информация о проблемах загрузки попадает к ним в багтрекер [NewPipeExtractor/issues](https://github.com/TeamNewPipe/NewPipeExtractor/issues), там же можно следить за статусом исправления. Так или иначе, до выпуска исправленной версии приходится ждать несколько дней (особенно, пользователям F-Droid).

_совет: хватит это терпеть! Гугл в очередной раз поломал совместимость сторонних плееров с Ютюбом? Найдите [подходящий сервер PeerTube](https://joinpeertube.org/) с поддержкой загрузки (или заведите свой инстанс), перенесите туда любимые ролики (интерфейс загрузки PeerTube позволяет импортировать ролики YouTube по ссылке, а так же указывать ссылки на торренты!) и добавьте канал в плейлист YaShlang!_

- Не будет играть ролики с возрастными ограничениями, требующие логин в аккаунт Гугл/Ютюб

например: [Илья Муромец, Киноконцерн "Мосфильм"](https://www.youtube.com/watch?v=hooaKxdXbfM), [Руслан и Людмила 1-ая серия / Ruslan and Lyudmila film 1, Киноконцерн "Мосфильм"](https://www.youtube.com/watch?v=2UoO2t536Ko)

_совет: добавлять такие ролики в черный список или попросить автора ролика снять ограничение, выставленное по ошибке._

- Не будет играть некоторые ролики-трансляции, для которых сервис возвращает нулевую длину (для таких роликов продолжительность в списках и галерее отмечена как "[dur undef]")

например: [Ну Погоди! Все Выпуски 🐰🐺 Союзмультфильм HD (Мультики для детей),  Мультики студии Союзмультфильм](https://www.youtube.com/watch?v=fwzpCVt2ExY), [Топ мультиков Союзмультфильм,  Мультики студии Союзмультфильм](https://www.youtube.com/watch?v=XK1_9fw5CwA)

_совет: добавлять такие ролики в черный список._

- Ролики, доступные только по прямым ссылкам, могут не попасть в локальный плейлист, даже если вы загружаете все ролики пользователя

например: [Укрощение огня 1 серия, Киноконцерн "Мосфильм"](https://www.youtube.com/watch?v=vwBKEKqLOLY)

- Если встретите публичный ролик, который не требует логин, играет в браузере, но не играет в плеере, присылайте баг-репорт (вполне возможно, проблема уже исправлена в новой версии _NewPipeExtractor_ и нужно будет только обновить сборку с этой версией, [например](https://github.com/sadr0b0t/yashlang/issues/1)).

- Интерфейс может подтормаживать при медленном (но не выключенном) интернете

updt: должно стать намного лучше после вот этой истории https://github.com/sadr0b0t/yashlang/issues/17

- Пару раз ловил невоспроизводимый NullPointerException на операциях, связанных с загрузкой информации с сервиса. Если приложение вдруг вылетело при какой-то операции (например, при добавлении нового плейлиста), скопируйте стек-трейс и пришлите сюда, а операцию повторите — скорее всего второй раз она завершится успешно.

- Ошибка "reCaptcha Challendge requested" при добавлении новых плейлистов

Гуглу не нравится большое количество запросов с одного адреса, поэтому он включает режим рекапчи. Можно переключиться на другую сеть (например, выключить подключение вайфай и перейти на мобильный интернет) или подождать до конца текущего часа (или подождите час), когда Гугл снимет бан для наказанного адреса.

- НЕ ДЕЛАЙТЕ ДУНГРЕЙД на версию 0.1.0 (или ниже) после того, как обновились на старшую версию (начиная с 0.2.0). Потеряете все данные - добавленные плейлисты, историю просмотров, закладки и т.п.!

Начиная с версии 0.2.0 эта проблема исправлена (на 0.2.0 можно будет делать безопасный даунгрейд, но не на 0.1.0!). Кроме того, версия 0.1.0 все равно больше не работает и никогда не заработает, т.к. Гугл в очередной раз поломал задействованный в ней API.

## В неопределенном будущем

- Загрузка роликов для просмотра оффлайн
- Экспорт и импорт базы для резервной копии и переноса между устройствами
- Режим аудио-плеера: играть в фоне звуковую дорожку при выключенном экране
- Локальные списки проигрывания с ручным добавлением элементов
- Другие онлайн-сервисы

